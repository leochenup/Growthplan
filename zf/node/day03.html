<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Day03</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="前端架构师成长计划！！">
    
    <link rel="preload" href="/Growthplan/assets/css/0.styles.dfa40466.css" as="style"><link rel="preload" href="/Growthplan/assets/js/app.a300a8f4.js" as="script"><link rel="preload" href="/Growthplan/assets/js/2.ddf548a0.js" as="script"><link rel="preload" href="/Growthplan/assets/js/11.1dde6390.js" as="script"><link rel="prefetch" href="/Growthplan/assets/js/10.889ffded.js"><link rel="prefetch" href="/Growthplan/assets/js/12.2a7a700c.js"><link rel="prefetch" href="/Growthplan/assets/js/13.86f682a0.js"><link rel="prefetch" href="/Growthplan/assets/js/3.7985bb7f.js"><link rel="prefetch" href="/Growthplan/assets/js/4.ad862490.js"><link rel="prefetch" href="/Growthplan/assets/js/5.44af799e.js"><link rel="prefetch" href="/Growthplan/assets/js/6.46475436.js"><link rel="prefetch" href="/Growthplan/assets/js/7.bba027cc.js"><link rel="prefetch" href="/Growthplan/assets/js/8.212e750a.js"><link rel="prefetch" href="/Growthplan/assets/js/9.21baed9e.js">
    <link rel="stylesheet" href="/Growthplan/assets/css/0.styles.dfa40466.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/Growthplan/" class="home-link router-link-active"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Node</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Growthplan/zf/node/day01.html" class="sidebar-link">day01</a></li><li><a href="/Growthplan/zf/node/day02.html" class="sidebar-link">day02</a></li><li><a href="/Growthplan/zf/node/day03.html" aria-current="page" class="active sidebar-link">Day03</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Growthplan/zf/node/day03.html#一道面试题" class="sidebar-link">一道面试题</a></li><li class="sidebar-sub-header"><a href="/Growthplan/zf/node/day03.html#基本概念" class="sidebar-link">基本概念</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Growthplan/zf/node/day03.html#node-作为中间层" class="sidebar-link">node 作为中间层</a></li><li class="sidebar-sub-header"><a href="/Growthplan/zf/node/day03.html#传统的语言" class="sidebar-link">传统的语言</a></li></ul></li><li class="sidebar-sub-header"><a href="/Growthplan/zf/node/day03.html#node-事件环" class="sidebar-link">node 事件环</a></li><li class="sidebar-sub-header"><a href="/Growthplan/zf/node/day03.html#常用-api" class="sidebar-link">常用 API</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Growthplan/zf/node/day03.html#process" class="sidebar-link">process</a></li><li class="sidebar-sub-header"><a href="/Growthplan/zf/node/day03.html#fs-模块" class="sidebar-link">fs 模块</a></li><li class="sidebar-sub-header"><a href="/Growthplan/zf/node/day03.html#path-模块" class="sidebar-link">path 模块</a></li><li class="sidebar-sub-header"><a href="/Growthplan/zf/node/day03.html#vm-模块" class="sidebar-link">vm 模块</a></li></ul></li></ul></li><li><a href="/Growthplan/zf/node/day04.html" class="sidebar-link">day04</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="day03"><a href="#day03" class="header-anchor">#</a> Day03</h1> <blockquote><p>2021.6.18</p></blockquote> <h2 id="一道面试题"><a href="#一道面试题" class="header-anchor">#</a> 一道面试题</h2> <div class="language-js line-numbers-mode"><pre class="language-js"><code>Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// promisA+规范里面如何规定的？</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>


<span class="token comment">// then0,then1,then2,then3,then4,then5</span>
<span class="token comment">// 在ecmapscript规范中有描述，如果你返回了一个promise 他不会立刻处理这个promise，</span>
<span class="token comment">// 会将这个promise放到异步方法中进行处理 （会再次新生成一个微任务）</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h2 id="基本概念"><a href="#基本概念" class="header-anchor">#</a> 基本概念</h2> <p>Node.js是一个基于 Chrome V8 引擎的 JavaScript 运行环境(runtime), Node不是一门语言是让js运行在后端的运行时,并且不包括javascript 全集,因为在服务端中不包含 DOM 和 BOM ,Node 也提供了一些新的模块例如 http,fs 模块等。Node.js 使用了事件驱动、非阻塞式 I/O 的模型，使其轻量又高效并且Node.js 的包管理器 npm，是全球最大的开源库生态系统。node是基于 js 的，前端来写服务端通过 node 是最方便的。node 内部采用的多线程，但是 node 中主线程还是单线程的 （文件读写，内部还是基于多线程的），特点是非阻塞 异步 I/O 和基于事件驱动。</p> <ul><li>node 中没有锁的概念</li> <li>node 的应用场景适用于处理 i/o (文件读写)密集型，不适合处理cpu密集型 (压缩加密 和计算相关的，因为 node 主线程是单线程的)</li> <li>node 中处理多个异步操作同一个文件件的场景 （靠队列实现）</li></ul> <p><strong>优势：</strong></p> <ol><li>可以解析 js 语法</li> <li>服务端渲染 vue，react</li> <li>中间层 （跨域）</li> <li>前端会用 node 来实现很多工具</li> <li>可以做后端</li></ol> <h3 id="node-作为中间层"><a href="#node-作为中间层" class="header-anchor">#</a> node 作为中间层</h3> <ol><li>用来处理跨域</li> <li>处理后台数据格式</li></ol> <p><img src="https://my-blog-leo.oss-cn-chengdu.aliyuncs.com/node-middle.png" alt=""></p> <h3 id="传统的语言"><a href="#传统的语言" class="header-anchor">#</a> 传统的语言</h3> <p>多线程同步</p> <ul><li>默认多个线程访问同一个资源 需要加锁</li> <li>在高并发场景下 ，多线程需要不停的切换时间片   “并发:cpu 不停的切换处理的线程 这几个线程就是并发”</li> <li>并行的概念 多线程  在不同的cpu下执行操作（不同的cpu同时处理不同的进程，进程并行），在进程中又有很多线程，被cpu进行并发处理。 采用多进程的方式（充分利用多核cpu），让系统更加稳定，而且可以实现高并发</li></ul> <h2 id="node-事件环"><a href="#node-事件环" class="header-anchor">#</a> node 事件环</h2> <ul><li>我们写的 js 代码会交给 v8 引擎进行处理</li> <li>代码中可能会调用 nodeApi, node 会交给 libuv 库处理</li> <li>libuv 通过阻塞 i/o 和多线程实现了异步 io</li> <li>通过事件驱动的方式,将结果放到事件队列中,最终交给我们的应用。</li></ul> <p><strong>什么是事件环</strong></p> <ol><li>node中处理非阻塞I/O的操作机制</li> <li>node启动后，就会初始化事件环</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>    本阶段执行已经被 setTimeout() 和 setInterval() 的调度回调函数。
   ┌───────────────────────────┐
┌─&gt;│           timers          │ 
│  └─────────────┬─────────────┘
|   执行延迟到下一个循环迭代的 I/O 回调。
│  ┌─────────────┴─────────────┐
│  │     pending callbacks     │
│  └─────────────┬─────────────┘
|   仅系统内部使用。
│  ┌─────────────┴─────────────┐
│  │       idle, prepare       │
│  └─────────────┬─────────────┘      
|  检索新的I/O事件;执行与 I/O相关的回调   ┌───────────────┐
│  ┌─────────────┴─────────────┐      │   incoming:   │
│  │           poll            │&lt;─────┤  connections, │
│  └─────────────┬─────────────┘      │   data, etc.  │
│  setImmediate() 回调函数在这里执行。   └───────────────┘
│  ┌─────────────┴─────────────┐      
│  │           check           │
│  └─────────────┬─────────────┘
|  一些关闭的回调函数
│  ┌─────────────┴─────────────┐
└──┤      close callbacks      │  
   └───────────────────────────┘
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p><strong>执行流程</strong></p> <ol><li>先进行主栈代码的执行，注意主栈代码也属于宏任务，微任务是语言提供的</li> <li>主栈代码执行后，会清空一次微任务队列，在清空微任务之前会先执行 process.nextTick(优先级高于微任务，不属于事件环的一部分)，然后会进入事件环执行</li> <li>node中的事件环包含以下几个阶段，timers、pending callbacks、idle，prepare、poll、close callbacks</li> <li>timers阶段，存放的是 setTimeout、setInterval 回调队列</li> <li>pending callbacks、close callbacks 不受我们控制的，系统内部控制</li> <li>poll阶段，存放异步I/O操作队列</li> <li>check阶段，存放setImmediate队列</li> <li>事件环的执行是从上到下依次执行的，如果主栈代码执行完毕后，这个时候 timers 中的队列为空，也就是定时器的等待时间还未到，会往下继续执行到 poll 阶段，查看异步队列是否有没有完成的任务吗，如果有就先处理poll中的队列，poll中的处理任务存在上限，最多当执行到99个的时候，会先退出 poll 阶段的执行，往下执行，如果poll阶段没有内容就执行check 阶段的检查，如果 check阶段队列存在任务，就执行，执行完毕后回到 timers 阶段继续事件环的执行，最终停在poll阶段阻塞等待</li> <li>注意，上面的几个队列中存放的都是宏任务，每执行完一个宏任务，就清空一次微任务队列，在老的node版本中，当整个阶段的队列都执行完毕后才会去清空一次微任务队列。</li></ol> <p><strong>poll阶段:</strong></p> <p>1.检测 Poll 队列中是否为空，如果不为空则执行队列中的任务，直到超时或者全部执行完毕。</p> <p>2.执行完毕后检测 setImmediate 队列是否为空，如果不为空则执行 check 阶段，如果为空则等待时间到达。时间到达后回到 timer 阶段</p> <p>3.等待时间到达是可能会出现新的 callback，此时也在当前阶段被清空。</p> <p><strong>node和浏览器事件环的差异</strong></p> <p>浏览器 1个队列 node 多个队列（宏任务队列）</p> <p>执行顺序都是 先执行代码 ==》 （node会清空nextTick） ==》 清空微任务  ==》在去取出一个和宏任务来执行，</p> <p>当到达 poll 阶段后，如果 check 阶段为空，而且 poll 里面也没有 io 操作，此时，不会继续轮询，会等待定时器到达时间，重新执行，或者有新的 i/o 操作进入到 poll 阶段中。</p> <h2 id="常用-api"><a href="#常用-api" class="header-anchor">#</a> 常用 API</h2> <p>服务端全局变量原则是是 global， 但是 node 在执行的时候为了实现模块化，会在执行代码时，外部包装一个函数，这个函数在执行的时候会改变 this 指向。</p> <p><strong>在 node 模块中可以直接访问这些变量 process __filename,  __dirname,  exports , module , require (这5个变量都是函数的参数)。后面的五个属性 都可以直接访问在文件中，但是不能通过 global 来获取</strong></p> <h3 id="process"><a href="#process" class="header-anchor">#</a> process</h3> <p><strong>platform</strong></p> <p>windows 得到的结果是 win32、mac 得到的结果是 darwin</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>platform<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>cwd</strong></p> <p>获取 node 文件执行的目录。cwd （current working directory ）你在哪执行的这个文件。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>__filename</strong> 代表文件的所在位置 是一个绝对路径。</p> <p>**__dirname ** 文件所在的目录 是一个绝对路径。</p> <p><strong>env</strong></p> <p>用来获取系统的环境变量。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>console.lg(process.env)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>开发中通常设置 NODE_ENV 变量来表明是否处于开发阶段。windows 下通过在终端下运行 <code>set xxx=yyy</code> （xxx 为环境变量名，yyy 为值）来设置环境变量。max 使用  <code>export xxx=yyy</code> 。</p> <p>使用</p> <p>终端中</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token builtin class-name">set</span> <span class="token assign-left variable">NODE_ENV</span><span class="token operator">=</span>development
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>node 文件中</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> requestUrl <span class="token operator">=</span> <span class="token string">''</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'develpoment'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    requestUrl <span class="token operator">=</span> <span class="token string">'http://localhost'</span>
<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
    requestUrl <span class="token operator">=</span> <span class="token string">'http://39.106.175.18xxx'</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>argv</strong></p> <p>用来获取运行时传入的参数</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">## cmd 下输入 node index.js --port 3000 --name demo</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>node 文件中</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">)</span>

<span class="token comment">// 得到的结果</span>
<span class="token punctuation">[</span>
  <span class="token string">'D:\\apps\\env\\node\\nvm\\v12.18.3\\node.exe'</span><span class="token punctuation">,</span>
  <span class="token string">'D:\\learnRecord\\zhufeng\\01.node阶段\\code\\04.module-buffer\\a\\index.js'</span><span class="token punctuation">,</span>
  <span class="token string">'--port'</span><span class="token punctuation">,</span>
  <span class="token string">'3000'</span><span class="token punctuation">,</span>
  <span class="token string">'--name'</span><span class="token punctuation">,</span>
  <span class="token string">'demo'</span>
<span class="token punctuation">]</span>

<span class="token comment">// 第一项代表的是可执行 node.exe </span>
<span class="token comment">// 第二项执行的是哪个文件</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>我们可以使用 <code>process.argv.slice(2)</code>  来获只取自己传入的参数。</p> <p>把参数解析成对象</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> args <span class="token operator">=</span> process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">// 执行命令时所带的参数 1.代表的是可执行node.exe 2.执行的是哪个文件</span>
<span class="token keyword">let</span> userArgs <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">memo<span class="token punctuation">,</span>current<span class="token punctuation">,</span>index<span class="token punctuation">,</span>arr</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>current<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'--'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        memo<span class="token punctuation">[</span>current<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> memo<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>userArgs<span class="token punctuation">)</span>

<span class="token comment">// 得到结果</span>
<span class="token punctuation">{</span>
    prot<span class="token operator">:</span> <span class="token string">'3000'</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">'demo'</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>但是一般不需要自己写参数的解析，一般使用 <a href="https://github.com/tj/commander.js/blob/HEAD/Readme_zh-CN.md" target="_blank" rel="noopener noreferrer">commander<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 这个库。</p> <p>示例</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>program
  <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">'-d, --debug'</span><span class="token punctuation">,</span> <span class="token string">'output extra debugging'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">'-s, --small'</span><span class="token punctuation">,</span> <span class="token string">'small pizza size'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token string">'-p, --pizza-type &lt;type&gt;'</span><span class="token punctuation">,</span> <span class="token string">'flavour of pizza'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

program<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> options <span class="token operator">=</span> program<span class="token punctuation">.</span><span class="token function">opts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>debug<span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'pizza details:'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>small<span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'- small pizza size'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>pizzaType<span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">- </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>options<span class="token punctuation">.</span>pizzaType<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="fs-模块"><a href="#fs-模块" class="header-anchor">#</a> fs 模块</h3> <p>文件处理模块
使用 <code>let fs = reuqeir('fs')</code> 引入 fs 模块。
内部两种api（同步、异步）
同步读取文件，但是在指定代码执行前执行的操作都可以采用同步的方式，不会阻塞指定任务（指定任务还没开始）。
如果在任务代码中要执行操作，那么该操作就用异步，不会阻塞任务执行。</p> <p>在读取文件之前目录可能不存在所以要降级处理</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> existsSync <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">existisSync</span><span class="token punctuation">(</span><span class="token string">'a.txt'</span><span class="token punctuation">)</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>existsSync<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 读取文件</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>fs.readFileSync</strong>
使用方式</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> existsSync <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">existisSync</span><span class="token punctuation">(</span><span class="token string">'a.txt'</span><span class="token punctuation">)</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>existsSync<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 读取文件</span>
    <span class="token keyword">let</span> data <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">'a.txt'</span><span class="token punctuation">,</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="path-模块"><a href="#path-模块" class="header-anchor">#</a> path 模块</h3> <p>路径处理模块
引入方式</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> path <span class="token operator">=</span> <span class="token function">requeir</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>join 与 resolve 方法</strong>
join 拼接路径，只将给定的参数拼接成路径。
resolve 拼接路径，但是返回绝对路径，它默认以 process.cwd() 为基础路径然后把参数拼接成绝对路径，如果遇见带 &quot;/&quot; 的参数，就以他为根路径，他前面的参数就忽略了，例子在下面。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;//b&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;c&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;...&quot;</span><span class="token punctuation">)</span> 
<span class="token comment">// a\b\c\...</span>
path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;//b&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;c&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;...&quot;</span><span class="token punctuation">)</span> 
<span class="token comment">// d:\b\c\...</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>relative 方法</strong>
接受两个参数，参数一 form 参数二 to 。该方法返回从 form 的路径 到 to 的路径访问路径，例子如下。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">relative</span><span class="token punctuation">(</span><span class="token string">'a/b'</span><span class="token punctuation">,</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// ..  从 a/b 路径到 a 路径只需要 .. 即可</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>basename 方法</strong>
获取最后一个文件的文件名，（用参数一减去参数二的结果）</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">basename</span><span class="token punctuation">(</span><span class="token string">'a/b/c/b.js'</span><span class="token punctuation">,</span><span class="token string">'.js'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// &quot;b&quot;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">basename</span><span class="token punctuation">(</span><span class="token string">'a/b/c/b.js'</span><span class="token punctuation">,</span><span class="token string">'b.js'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// &quot;b.js&quot;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">basename</span><span class="token punctuation">(</span><span class="token string">'b.js'</span><span class="token punctuation">,</span><span class="token string">'.js'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// &quot;b&quot;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">basename</span><span class="token punctuation">(</span><span class="token string">'b.js'</span><span class="token punctuation">,</span><span class="token string">'b.js'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// &quot; &quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>extname</strong>
取路径最后一个后缀名为结果</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">extname</span><span class="token punctuation">(</span><span class="token string">'c/a/b.js'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// '.js'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>dirname 方法</strong>
返回当前路径的父路径（目录名）
Return the directory name of a path
与 __dirname 相同，__dirname 其内部就是这样实现的。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">dirname</span><span class="token punctuation">(</span>__filename<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="vm-模块"><a href="#vm-模块" class="header-anchor">#</a> vm 模块</h3> <p>虚拟机模块，基本用不着，可以让字符串执行。
与 eval、new Function 类似，这两个方法可能手=收到外界的影响，可能有一些问题。
eval 执行时会采用上级的变量，可能受外界因素影响，可能会有问题</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">&quot;console.log(fs)&quot;</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>new Function 会生成全局函数、执行时会采用上级的变量，可能受外界因素影响，可能会有问题</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> sum <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Function</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token string">'b'</span><span class="token punctuation">,</span><span class="token string">'return a + b'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 3</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>vm 可以单独产生一个作用域，不会被外部影响亦不会影响外部。
沙箱执行，实现一个全新的上下文。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>vm<span class="token punctuation">.</span><span class="token function">runInNewContext</span><span class="token punctuation">(</span><span class="token string">'console.log(a)'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p><strong>问题</strong>
js 中如何实现沙箱机制？ （内部执行与外部执行的代码毫不关联）</p></blockquote></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Growthplan/zf/node/day02.html" class="prev">
        day02
      </a></span> <span class="next"><a href="/Growthplan/zf/node/day04.html">
        day04
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/Growthplan/assets/js/app.a300a8f4.js" defer></script><script src="/Growthplan/assets/js/2.ddf548a0.js" defer></script><script src="/Growthplan/assets/js/11.1dde6390.js" defer></script>
  </body>
</html>
